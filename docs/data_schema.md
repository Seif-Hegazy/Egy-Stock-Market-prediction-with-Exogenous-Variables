# Data Schema Documentation

## Overview

This document describes the data models and file structures used in the EgySentiment platform.

---

## 1. Stock Market Data

### File: `data/raw/stocks/egx_daily_12y.csv`

**Description**: 12-year historical stock data for EGX100 tickers

**Schema**:

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| `Date` | date | Trading date | `2024-12-12` |
| `Ticker` | string | Stock symbol | `COMI.CA` |
| `ISIN` | string | International Securities ID | `EGS48701C018` |
| `Sector` | string | Industry sector | `Financial Services` |
| `Open` | float | Opening price (EGP) | `45.20` |
| `High` | float | Highest price (EGP) | `46.10` |
| `Low` | float | Lowest price (EGP) | `44.80` |
| `Close` | float | Closing price (EGP) | `45.90` |
| `Volume` | integer | Trading volume | `1250000` |

**Sample Row**:
```csv
Date,Ticker,ISIN,Sector,Open,High,Low,Close,Volume
2024-12-12,COMI.CA,EGS48701C018,Financial Services,45.2,46.1,44.8,45.9,1250000
```

**Size**: ~500-1000 MB (12 years × 35 tickers)  
**Update Frequency**: Daily at 16:30 Cairo Time  
**Source**: Yahoo Finance (`yfinance`)

---

## 2. Ticker Metadata

### File: `data/metadata/stocks/ticker_info.json`

**Description**: Cached ticker metadata to minimize API calls

**Schema**:

```json
{
  "COMI.CA": {
    "isin": "EGS48701C018",
    "sector": "Financial Services"
  },
  "HRHO.CA": {
    "isin": "EGS48211C015",
    "sector": "Financial Services"
  }
}
```

**Fields**:
- `isin` (string): International Securities Identification Number
- `sector` (string): Industry classification

**Size**: ~2-5 KB  
**Update Frequency**: On-demand (cached after first fetch)

---

## 3. News Articles

### File: `data/raw/news/articles.jsonl`

**Description**: Scraped financial news articles (JSONL format - one JSON per line)

**Schema**:

```json
{
  "text": "Full article text...",
  "title": "Article headline",
  "sentiment": "positive|negative|neutral",
  "reasoning": "LLM explanation for sentiment",
  "source": "https://source-url.com",
  "published": "2024-12-12 10:30:00",
  "timestamp": "2024-12-12T10:30:00.123456"
}
```

**Fields**:

| Field | Type | Description |
|-------|------|-------------|
| `text` | string | Full article content |
| `title` | string | Article headline |
| `sentiment` | enum | `positive`, `negative`, or `neutral` |
| `reasoning` | string | LLM explanation for classification |
| `source` | string | URL of article source |
| `published` | datetime | Publication timestamp |
| `timestamp` | datetime | Scraping timestamp (ISO 8601) |

**Size**: ~50-100 MB (1000+ articles)  
**Update Frequency**: Daily scraping runs

---

## 4. Economic Indicators

### File: `data/raw/economic/egypt_economic_data.csv`

**Description**: Macroeconomic indicators for Egypt

**Schema**:

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| `Date` | date | Indicator date | `2024-12-01` |
| `GDP_Growth` | float | GDP growth rate (%) | `3.5` |
| `Inflation_Rate` | float | Consumer price inflation (%) | `12.3` |
| `Interest_Rate` | float | Central bank rate (%) | `19.25` |
| `USD_EGP` | float | Exchange rate (EGP per USD) | `48.50` |

**Sample Row**:
```csv
Date,GDP_Growth,Inflation_Rate,Interest_Rate,USD_EGP
2024-12-01,3.5,12.3,19.25,48.50
```

**Size**: ~500 KB  
**Update Frequency**: Monthly  
**Source**: World Bank, FRED, CBE

---

## 5. Forecast Features

### File: `data/processed/news/forecast_features.csv`

**Description**: Engineered features for ML forecasting

**Schema**:

| Column | Type | Description |
|--------|------|-------------|
| `Date` | date | Feature date |
| `Ticker` | string | Stock symbol |
| `Close` | float | Closing price |
| `Volume` | integer | Trading volume |
| `Return_1d` | float | 1-day return (%) |
| `Return_5d` | float | 5-day return (%) |
| `Volatility_20d` | float | 20-day rolling volatility |
| `MA_5` | float | 5-day moving average |
| `MA_20` | float | 20-day moving average |
| `Sentiment_Score` | float | Aggregated news sentiment (-1 to +1) |
| `GDP_Growth` | float | GDP growth rate (merged from economic data) |

**Size**: ~2.5 MB  
**Usage**: ML model training input  
**Generated By**: `scripts/create_forecast_features.py`

---

## 6. Processed News

### Directory: `data/processed/news/`

**Description**: Sentiment-analyzed and aggregated news data

**File Naming**: `{YYYY-MM-DD}_sentiment.json`

**Schema**:

```json
{
  "date": "2024-12-12",
  "total_articles": 45,
  "sentiment_distribution": {
    "positive": 20,
    "negative": 15,
    "neutral": 10
  },
  "average_sentiment": 0.12,
  "top_keywords": ["CIB", "inflation", "EGX"]
}
```

---

## Data Relationships

```
Stock Data (egx_daily_12y.csv)
    ├── Ticker → Metadata (ticker_info.json)
    └── Date → Economic Indicators (egypt_indicators.csv)

News Articles (articles.jsonl)
    ├── Sentiment → Aggregated Daily Sentiment
    └── Date → Stock Data (for Granger Causality)

Forecast Features (forecast_features.csv)
    ├── Stock Data (Close, Volume)
    ├── Economic Indicators (GDP, Inflation)
    └── News Sentiment (Sentiment_Score)
```

---

## File Formats

### CSV (Comma-Separated Values)
- **Encoding**: UTF-8
- **Delimiter**: `,` (comma)
- **Quote Character**: `"` (double quote)
- **Header**: First row contains column names

### JSONL (JSON Lines)
- **Encoding**: UTF-8
- **Format**: One JSON object per line
- **Use Case**: Streamable, append-friendly

### JSON (JavaScript Object Notation)
- **Encoding**: UTF-8
- **Indentation**: 2 spaces
- **Use Case**: Configuration, metadata

---

## Data Quality

### Validation Rules

1. **Stock Data**:
   - `Close > 0`
   - `Volume >= 0`
   - `Date` format: `YYYY-MM-DD`
   - No duplicate (Date, Ticker) pairs

2. **News Articles**:
   - `sentiment` must be one of: `positive`, `negative`, `neutral`
   - `timestamp` in ISO 8601 format
   - `text` not empty

3. **Economic Indicators**:
   - Numeric fields not NULL
   - `Date` chronologically ordered

### Missing Data Handling

- **Stock Data**: Gaps filled with forward-fill (carry last value)
- **News Sentiment**: Missing days assigned neutral (0.0)
- **Economic Indicators**: Interpolated linearly for missing months

---

## Versioning

**Schema Version**: 1.0  
**Last Updated**: 2024-12-12  
**Change Log**: See `docs/schema_changelog.md`
